<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÄÄƒng BÃ i Viáº¿t</title>
    <link rel="stylesheet" href="css/post-handbook.css">
    <link rel="stylesheet" href="css/root.css">

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ÄÄƒng BÃ i Viáº¿t Má»›i</h1>
            <p>Chia sáº» cÃ¢u chuyá»‡n cá»§a báº¡n vá»›i má»i ngÆ°á»i</p>
        </div>

        <div class="form-container">
            <div class="form-group">
                <label for="title">TiÃªu Ä‘á» bÃ i viáº¿t</label>
                <input type="text" id="title" placeholder="Nháº­p tiÃªu Ä‘á» háº¥p dáº«n..." required>
            </div>

            <div class="form-group">
                <label>Ná»™i dung bÃ i viáº¿t (chia tá»«ng Ä‘oáº¡n)</label>
                <div class="paragraphs-container" id="paragraphsContainer">
                    <!-- Paragraphs will be added here -->
                </div>
                <button type="button" class="add-paragraph-btn" id="addParagraphBtn">
                    â• ThÃªm Äoáº¡n Má»›i
                </button>
            </div>

            <button type="button" class="btn-submit" id="submitBtn">ğŸ“¤ ÄÄƒng BÃ i</button>
        </div>

        <div class="preview-section" id="previewSection">
            <h2>ğŸ‰ BÃ i viáº¿t cá»§a báº¡n</h2>
            <div class="post-preview" id="postPreview">
                <h3 id="previewTitle"></h3>
                <div id="previewContent"></div>
            </div>
        </div>
    </div>

    <script>
        let paragraphCount = 0;
        const paragraphs = {};

        const paragraphsContainer = document.getElementById('paragraphsContainer');
        const addParagraphBtn = document.getElementById('addParagraphBtn');
        const submitBtn = document.getElementById('submitBtn');
        const previewSection = document.getElementById('previewSection');

        // Add first paragraph on load
        addParagraph();

        addParagraphBtn.addEventListener('click', addParagraph);

        function addParagraph() {
            paragraphCount++;
            const id = 'para_' + paragraphCount;
            
            const paraDiv = document.createElement('div');
            paraDiv.className = 'paragraph-item';
            paraDiv.id = id;
            
            paraDiv.innerHTML = `
                <div class="paragraph-header">
                    <span class="paragraph-number">ğŸ“ Äoáº¡n ${paragraphCount}</span>
                    ${paragraphCount > 1 ? '<button type="button" class="remove-paragraph" onclick="removeParagraph(\'' + id + '\')">ğŸ—‘ï¸ XÃ³a</button>' : ''}
                </div>
                <input type="text" class="paragraph-heading" placeholder="TiÃªu Ä‘á» Ä‘oáº¡n ${paragraphCount} (tÃ¹y chá»n)" data-id="${id}" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; margin-bottom: 12px; font-weight: 600;">
                <textarea placeholder="Viáº¿t ná»™i dung Ä‘oáº¡n ${paragraphCount}..." data-id="${id}"></textarea>
                <div class="image-upload" onclick="triggerFileInput('${id}')">
                    <div class="upload-icon">ğŸ“·</div>
                    <div class="upload-text">Chá»n hÃ¬nh cho Ä‘oáº¡n nÃ y (tÃ¹y chá»n)</div>
                    <input type="file" class="file-input" id="file_${id}" accept="image/*" onchange="handleImageUpload('${id}', event)">
                </div>
                <div class="image-preview" id="preview_${id}">
                    <img id="img_${id}" src="" alt="Preview">
                    <button type="button" class="remove-img-btn" onclick="removeImage('${id}')">XÃ³a áº£nh</button>
                </div>
            `;
            
            paragraphsContainer.appendChild(paraDiv);
            paragraphs[id] = { heading: '', text: '', image: null };
            
            // Add event listener for heading
            const heading = paraDiv.querySelector('.paragraph-heading');
            heading.addEventListener('input', (e) => {
                paragraphs[id].heading = e.target.value;
            });
            
            // Add event listener for textarea
            const textarea = paraDiv.querySelector('textarea');
            textarea.addEventListener('input', (e) => {
                paragraphs[id].text = e.target.value;
                autoResize(e.target);
            });
            
            // Set initial height
            autoResize(textarea);
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        window.removeParagraph = function(id) {
            const para = document.getElementById(id);
            if (para) {
                para.remove();
                delete paragraphs[id];
                updateParagraphNumbers();
            }
        };

        function updateParagraphNumbers() {
            const items = document.querySelectorAll('.paragraph-item');
            items.forEach((item, index) => {
                const number = item.querySelector('.paragraph-number');
                if (number) {
                    number.textContent = `ğŸ“ Äoáº¡n ${index + 1}`;
                }
            });
        }

        window.triggerFileInput = function(id) {
            document.getElementById('file_' + id).click();
        };

        window.handleImageUpload = function(id, event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    paragraphs[id].image = e.target.result;
                    document.getElementById('img_' + id).src = e.target.result;
                    document.getElementById('preview_' + id).style.display = 'block';
                    document.querySelector('#' + id + ' .image-upload').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        };

        window.removeImage = function(id) {
            paragraphs[id].image = null;
            document.getElementById('file_' + id).value = '';
            document.getElementById('preview_' + id).style.display = 'none';
            document.querySelector('#' + id + ' .image-upload').style.display = 'block';
        };

        submitBtn.addEventListener('click', () => {
            const title = document.getElementById('title').value;
            
            if (!title.trim()) {
                alert('âš ï¸ Vui lÃ²ng nháº­p tiÃªu Ä‘á» bÃ i viáº¿t!');
                return;
            }

            let hasContent = false;
            for (let id in paragraphs) {
                if (paragraphs[id].text.trim()) {
                    hasContent = true;
                    break;
                }
            }

            if (!hasContent) {
                alert('âš ï¸ Vui lÃ²ng viáº¿t Ã­t nháº¥t má»™t Ä‘oáº¡n ná»™i dung!');
                return;
            }

            // Generate preview
            document.getElementById('previewTitle').textContent = title;
            
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = '';

            for (let id in paragraphs) {
                const para = paragraphs[id];
                if (para.text.trim()) {
                    const paraDiv = document.createElement('div');
                    paraDiv.className = 'preview-paragraph';
                    
                    if (para.heading.trim()) {
                        const headingEl = document.createElement('h4');
                        headingEl.style.cssText = 'color: #667eea; margin-bottom: 12px; font-size: 1.3em;';
                        headingEl.textContent = para.heading;
                        paraDiv.appendChild(headingEl);
                    }
                    
                    const textDiv = document.createElement('div');
                    textDiv.className = 'text';
                    textDiv.textContent = para.text;
                    paraDiv.appendChild(textDiv);
                    
                    if (para.image) {
                        const img = document.createElement('img');
                        img.src = para.image;
                        img.alt = 'HÃ¬nh minh há»a';
                        paraDiv.appendChild(img);
                    }
                    
                    previewContent.appendChild(paraDiv);
                }
            }

            previewSection.style.display = 'block';
            previewSection.scrollIntoView({ behavior: 'smooth' });
            alert('âœ… ÄÄƒng bÃ i thÃ nh cÃ´ng!');
        });
    </script>
</body>
</html>