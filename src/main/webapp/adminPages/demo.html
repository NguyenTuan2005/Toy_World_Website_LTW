<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cập Nhật Thương Hiệu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .image-preview-container {
            width: 100%;
            max-width: 300px;
            height: 300px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
            position: relative;
            overflow: hidden;
            margin: 0 auto;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .image-preview-container:hover {
            border-color: #0d6efd;
            background-color: #e7f1ff;
        }
        .image-preview {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: none;
        }
        .image-preview.show {
            display: block;
        }
        .upload-placeholder {
            text-align: center;
            color: #6c757d;
            pointer-events: none;
        }
        .upload-placeholder.hide {
            display: none;
        }
        .remove-image-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            display: none;
            z-index: 10;
            transition: all 0.2s ease;
        }
        .remove-image-btn.show {
            display: block;
        }
        .remove-image-btn:hover {
            background: rgba(220, 53, 69, 1);
            transform: scale(1.1);
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-edit"></i> Cập Nhật Thương Hiệu</h2>
                <button onclick="goBack()" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left"></i> Quay lại
                </button>
            </div>

            <!-- Form Card -->
            <div class="card shadow">
                <div class="card-body p-4">
                    <form id="brandForm">

                        <!-- Tên thương hiệu -->
                        <div class="mb-4">
                            <label for="brandName" class="form-label fw-bold">
                                <i class="fas fa-tag"></i> Tên Thương Hiệu <span class="text-danger">*</span>
                            </label>
                            <input type="text"
                                   class="form-control form-control-lg"
                                   id="brandName"
                                   required
                                   placeholder="Nhập tên thương hiệu">
                        </div>

                        <!-- Hình ảnh -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-image"></i> Hình Ảnh Thương Hiệu
                            </label>

                            <!-- Preview Container -->
                            <div class="image-preview-container" onclick="document.getElementById('imageFile').click()">
                                <img id="imagePreview" class="image-preview" src="" alt="Preview">

                                <div id="uploadPlaceholder" class="upload-placeholder">
                                    <i class="fas fa-cloud-upload-alt fa-3x mb-2"></i>
                                    <p class="mb-0 fw-bold">Nhấn để chọn hình ảnh</p>
                                    <small class="text-muted">PNG, JPG, JPEG (Max 5MB)</small>
                                </div>

                                <button type="button"
                                        id="removeImageBtn"
                                        class="remove-image-btn"
                                        onclick="removeImage(event)">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <!-- File Input (ẩn) -->
                            <input type="file"
                                   class="d-none"
                                   id="imageFile"
                                   accept="image/png, image/jpeg, image/jpg"
                                   onchange="previewImage(event)">

                            <small class="text-muted d-block mt-2 text-center">
                                <i class="fas fa-info-circle"></i> Chỉ được chọn 1 hình ảnh
                            </small>
                        </div>

                        <!-- Số sản phẩm -->
                        <div class="mb-4">
                            <label for="productCount" class="form-label fw-bold">
                                <i class="fas fa-box"></i> Số Sản Phẩm
                            </label>
                            <input type="number"
                                   class="form-control"
                                   id="productCount"
                                   value="0"
                                   min="0"
                                   placeholder="Số lượng sản phẩm">
                        </div>

                        <!-- Trạng thái -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-toggle-on"></i> Trạng Thái
                            </label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input"
                                           type="radio"
                                           name="status"
                                           id="statusActive"
                                           value="active"
                                           checked>
                                    <label class="form-check-label" for="statusActive">
                                        <span class="badge bg-success">
                                            <i class="fas fa-unlock"></i> Hoạt động
                                        </span>
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input"
                                           type="radio"
                                           name="status"
                                           id="statusLocked"
                                           value="locked">
                                    <label class="form-check-label" for="statusLocked">
                                        <span class="badge bg-danger">
                                            <i class="fas fa-lock"></i> Đã khóa
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <!-- Buttons -->
                        <div class="d-flex gap-2 justify-content-end">
                            <button type="button" onclick="goBack()" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Hủy
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Lưu Thay Đổi
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast thông báo -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="toast" class="toast hide" role="alert">
        <div class="toast-header">
            <i class="fas fa-check-circle text-success me-2"></i>
            <strong class="me-auto">Thông báo</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toastMessage"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let selectedImage = null;

    // Load dữ liệu mẫu khi trang load (giả lập load từ server)
    window.onload = function() {
        // Giả lập dữ liệu brand từ server
        const brandData = {
            name: "Nike",
            imageUrl: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg",
            productCount: 150,
            status: "active",
            description: "Thương hiệu thể thao hàng đầu thế giới"
        };

        // Điền dữ liệu vào form
        loadBrandData(brandData);
    };

    function loadBrandData(data) {
        document.getElementById('brandName').value = data.name || '';
        document.getElementById('productCount').value = data.productCount || 0;
        document.getElementById('description').value = data.description || '';

        // Set status
        if (data.status === 'locked') {
            document.getElementById('statusLocked').checked = true;
        } else {
            document.getElementById('statusActive').checked = true;
        }

        // Load image nếu có
        if (data.imageUrl) {
            const preview = document.getElementById('imagePreview');
            const placeholder = document.getElementById('uploadPlaceholder');
            const removeBtn = document.getElementById('removeImageBtn');

            preview.src = data.imageUrl;
            preview.classList.add('show');
            placeholder.classList.add('hide');
            removeBtn.classList.add('show');
        }
    }

    function previewImage(event) {
        const file = event.target.files[0];

        if (file) {
            // Kiểm tra kích thước file (5MB)
            if (file.size > 5 * 1024 * 1024) {
                showToast('Kích thước file không được vượt quá 5MB!', 'error');
                event.target.value = '';
                return;
            }

            // Kiểm tra định dạng file
            const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg'];
            if (!allowedTypes.includes(file.type)) {
                showToast('Chỉ chấp nhận file PNG, JPG hoặc JPEG!', 'error');
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('imagePreview');
                const placeholder = document.getElementById('uploadPlaceholder');
                const removeBtn = document.getElementById('removeImageBtn');

                preview.src = e.target.result;
                preview.classList.add('show');
                placeholder.classList.add('hide');
                removeBtn.classList.add('show');

                selectedImage = file;
            };
            reader.readAsDataURL(file);
        }
    }

    function removeImage(event) {
        event.stopPropagation(); // Ngăn trigger click vào container

        const preview = document.getElementById('imagePreview');
        const placeholder = document.getElementById('uploadPlaceholder');
        const removeBtn = document.getElementById('removeImageBtn');
        const fileInput = document.getElementById('imageFile');

        // Reset preview
        preview.src = '';
        preview.classList.remove('show');
        placeholder.classList.remove('hide');
        removeBtn.classList.remove('show');

        // Clear file input
        fileInput.value = '';
        selectedImage = null;
    }

    function goBack() {
        if (confirm('Bạn có chắc muốn hủy? Các thay đổi sẽ không được lưu.')) {
            window.history.back();
        }
    }

    // Xử lý submit form
    document.getElementById('brandForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const brandName = document.getElementById('brandName').value.trim();
        const productCount = document.getElementById('productCount').value;
        const status = document.querySelector('input[name="status"]:checked').value;
        const description = document.getElementById('description').value.trim();

        if (!brandName) {
            showToast('Vui lòng nhập tên thương hiệu!', 'error');
            return;
        }

        // Tạo FormData để gửi lên server
        const formData = new FormData();
        formData.append('name', brandName);
        formData.append('productCount', productCount);
        formData.append('status', status);
        formData.append('description', description);

        if (selectedImage) {
            formData.append('image', selectedImage);
        }

        // Giả lập gửi dữ liệu lên server
        console.log('Dữ liệu gửi lên server:');
        console.log('- Tên:', brandName);
        console.log('- Số sản phẩm:', productCount);
        console.log('- Trạng thái:', status);
        console.log('- Mô tả:', description);
        console.log('- Hình ảnh:', selectedImage ? selectedImage.name : 'Không có');

        showToast('Cập nhật thương hiệu thành công!', 'success');

        // Sau 2 giây quay về trang trước
        setTimeout(() => {
            // window.location.href = 'brand-list.html'; // Chuyển đến trang danh sách
        }, 2000);
    });

    function showToast(message, type = 'success') {
        const toastEl = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const toastHeader = toastEl.querySelector('.toast-header');

        toastMessage.textContent = message;

        // Đổi màu icon theo loại
        const icon = toastHeader.querySelector('i');
        if (type === 'error') {
            icon.className = 'fas fa-exclamation-circle text-danger me-2';
        } else {
            icon.className = 'fas fa-check-circle text-success me-2';
        }

        const toast = new bootstrap.Toast(toastEl);
        toast.show();
    }
</script>

</body>
</html>